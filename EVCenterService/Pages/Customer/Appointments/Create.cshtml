@page
@model EVCenterService.Pages.Customer.Appointments.CreateModel
@{
    Layout = "_AppLayout";
    ViewData["Title"] = "Create Booking/Order";
}

<h2>Order Service</h2>

<form method="post" class="card p-4 shadow-sm bg-light">
    <!-- Chọn xe -->
    <div class="form-group mb-3">
        <label class="fw-bold">Chọn xe:</label>
        <select asp-for="Booking.VehicleId" asp-items="Model.VehicleList" class="form-control" required>
            <option value="">-- Chọn xe của bạn --</option>
        </select>
    </div>

    <!-- Chọn dịch vụ -->
    <div class="form-group mb-3">
        <label class="fw-bold">Chọn loại dịch vụ:</label>
        <select id="serviceSelect" asp-for="SelectedServiceId" asp-items="Model.ServiceList" class="form-control" required>
            <option value="">-- Chọn dịch vụ cần thực hiện --</option>
        </select>
        <small class="text-muted d-block mt-1">
            Hệ thống sẽ tự động hiển thị giá dịch vụ bạn chọn.
        </small>
    </div>

    <!-- Hiển thị giá -->
    <div id="priceSection" class="form-group mb-3" style="display:none;">
        <label class="fw-bold">Giá dịch vụ:</label>
        <div class="input-group">
            <input id="servicePrice" type="text" class="form-control" readonly value="0 đ" />
            <span class="input-group-text bg-light"><i class="bi bi-cash-stack"></i></span>
        </div>
    </div>

    <!-- Ngày -->
    <div class="form-group mb-3">
        <label class="fw-bold">Ngày hẹn:</label>
        <input asp-for="Booking.AppointmentDate"
               type="date"
               class="form-control"
               value="@DateTime.Now.ToString("yyyy-MM-dd")"
               min="@DateTime.Now.ToString("yyyy-MM-dd")"
               required />
    </div>

    <!-- Giờ -->
    <div class="form-group mb-3">
        <label class="fw-bold">Giờ hẹn:</label>
        <input asp-for="SelectedTime" type="time" class="form-control" value="09:00" required />
    </div>

    <!-- Ghi chú -->
    <div class="form-group mb-3">
        <label class="fw-bold">Ghi chú (tùy chọn):</label>
        <textarea asp-for="Booking.ChecklistNote"
                  class="form-control"
                  rows="3"
                  placeholder="VD: Kiểm tra hệ thống phanh, pin, điều hòa..."></textarea>
    </div>

    <!-- Nút hành động -->
    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Gửi yêu cầu</button>
        <a asp-page="Index" class="btn btn-secondary ms-2">Hủy</a>
    </div>
</form>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const serviceSelect = document.getElementById("serviceSelect");
            const priceInput = document.getElementById("servicePrice");
            const priceSection = document.getElementById("priceSection");

            serviceSelect.addEventListener("change", function () {
                const selectedOption = this.options[this.selectedIndex];
                const text = selectedOption.text;
                const match = text.match(/- ([\d.,]+) đ/);

                if (match) {
                    priceInput.value = match[1] + " đ";
                    priceSection.style.display = "block";
                } else {
                    priceInput.value = "0 đ";
                    priceSection.style.display = "none";
                }
            });
        });
    </script>
}